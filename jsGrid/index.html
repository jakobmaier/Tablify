<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>jsGrid Demo</title>
    <link rel="stylesheet" href="css/reset.css" type="text/css" />
    <link rel="stylesheet" href="css/demo.css" type="text/css" />
    <link rel="stylesheet" href="css/jsGrid.css" type="text/css" />
    <script src="lib/jQuery/jquery-2.1.3.js"></script>
    <script src="Debugging.js"></script>
    <script src="TypeDefinitions.js"></script>
    <script src="jsGrid.js"></script>
    <script src="Column.js"></script>
    <script src="Cell.js"></script>
    <script src="Row.js"></script>
    <script type="text/javascript">
        /*
         * Called, when the "Generate Table" Button is pressed
         */
        function generateTable() {
            var descr = $("#tableDescription").val();
            var obj;
            try{
                obj = JSON.parse(descr);
            } catch (e) {
                alert("Invalid JSON\n" + e.message);
                return;
            }            
            new JsGrid.Table("#content", obj);
        }

        /*
         * Registers event handlers, so that "updateTableList()" is called everytime a new table is generated / an existing table is destroyed
         */
        $(document).ready(function () {
            JsGrid.tableStore.onTableRegistered = function (table) {
                updateTableList();
            };
            JsGrid.tableStore.onTableUnregistered = function (table) {
                updateTableList();
            };
            updateTableList();    

            $("#tools textarea").focusin(function () {
                $(this).css("height", "500%");
            });
            $("#tools textarea").focusout(function () {
                $(this).css("height", "");
            });
        });


        /*
         * Updates the select-box's content (Is called everytime a new table is generated)
         */
        function updateTableList() {
            $("#tableSelect").empty();
            var tableList = JsGrid.tableStore.tableList;
            for (var i = 0; i < tableList.length; ++i) {
                $("#tableSelect").append("<option>" + tableList[i].gridId + "</option>");
            }
        }

        /*
         * Called, when the "-->" Button (Serialise button) is pressed
         */
        function serialiseTable() {
            var gridId = $("#tableSelect").val();
            var table = JsGrid.tableStore.getTableById(gridId);
            var withData = $("#includeData").is(':checked');
            if (table !== null) {
                $("#tableDescription").val(JSON.stringify(table.toObject(withData), null, 4));
            }
        }
    </script>
    </head>
<body>
    <div id="header">
        <h1>jsGrid Demo</h1>
        <div id="tools">
            <span id="serialise">
                <select id="tableSelect"></select>
                <span>
                    <label><input id="includeData" type="checkbox"> Include data</label>
                </span>
                <input type="button" value="-->" onclick="serialiseTable()" />
            </span>
            <textarea id="tableDescription">{"columns":[{"columnId": "col1", "defaultBodyContent":"---"}],"rows":["row1", "row2"]}</textarea>
            <input type="button" id="generateTable" value="Generate Table" onclick="generateTable()" />
        </div>
    </div>


    <div id="content">
    </div>
</body>
</html>
